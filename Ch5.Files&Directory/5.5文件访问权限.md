# 5.5 文件访问权限

所有文件类型（目录、设备文件）都有访问权限（access permission），不只有普通文件有访问权限。

## 5.5.1 【普通权限】和【特殊权限】

文件权限可分为两大类：
* 普通权限：包括对文件的读、写、执行。
* 特殊权限：包括对文件的附加权限，如set user id和set group id等。

### 普通权限

每个文件都有9个访问权限位，可分为3类
* 文件所有者
    * 读权限
    * 写权限
    * 执行权限
* 同组用户
    * 读权限
    * 写权限
    * 执行权限
* 其他用户
    * 读权限
    * 写权限
    * 执行权限

当进程每次对文件进行读、写、执行等操作时，内核就会对文件进行访问权限检查，以确定该进程对文件是否拥有相应的权限。

首先要搞清楚该进程对于需要进行操作的文件来说是属于哪一类“角色”：
* 如果<b>【进程的有效用户ID】</b>等于<b>【文件所有者ID】</b>，意味着该进程以文件所有者的角色存在。
* 如果<b>【进程的有效用户ID】</b>并不等于<b>【文件所有者ID】</b>，意味着该进程并不是文件所有者身份；但是<b>【进程的有效用户组ID】</b>或<b>【进程的附属组ID】</b>之一等于<b>【文件的组ID】</b>，那么意味着该进程以文件所属组成员的角色存在，也就是文件所属组的同组用户成员。
* 如果<b>【进程的有效用户ID】</b>不等于<b>【文件所有者ID】</b>、并且<b>【进程的有效用户组ID】</b>或<b>【进程的所有附属组ID】</b>均不等于<b>【文件的组ID】</b>，那么意味着该进程以其它用户的角色存在。
* 如果<b>【进程的有效用户ID】</b>等于0（root 用户），则无需进行权限检查，直接对该文件拥有最高权限。

### 特殊权限

st_mode字段中除了记录文件的9个普通权限之外，还记录了文件的3个特殊权限。

S 字段三个 bit 位中，从高位到低位依次表示文件的：

* set-user-ID 位权限
* set-group-ID 位权限
* sticky 位权限

这三种权限分别使用 S_ISUID、S_ISGID 和 S_ISVTX 三个宏来表示：
``` 
S_ISUID 100 000 000 000 set-user-ID bit
S_ISGID 010 000 000 000 set-group-ID bit
S_ISVTX 001 000 000 000 sticky bit
```

* 当进程对文件进行操作的时候、将进行权限检查，如果文件的 set-user-ID 位权限被设置，内核会将进程的有效 ID 设置为该文件的用户 ID（文件所有者 ID），意味着该进程直接获取了文件所有者的权限、以文件所有者的身份操作该文件。
* 当进程对文件进行操作的时候、将进行权限检查，如果文件的 set-group-ID 位权限被设置，内核会将进程的有效用户组 ID 设置为该文件的用户组 ID（文件所属组 ID），意味着该进程直接获取了文件所属组成员的权限、以文件所属组成员的身份操作该文件。
* Sticky 位权限：略

## 5.5.2 目录权限

## 5.5.3 检查文件权限access

## 5.5.4 修改文件权限chmod

## 5.5.5 umask函数