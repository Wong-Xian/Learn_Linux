# uboot 启动过程的分析

## 分析链接脚本 uboot.lds
- 要先编译 uboot 才会在根目录下出现 u-boot.lds 文件
- _start 在文件 arch/arm/lib/vectors.S 中定义
- 看 u-boot.map 文件934行，镜像复制的起始地址是87800000
- 看回 uboot.lds 的 .text 段，先是 img_copy_start 段，然后到中断向量表，然后到 start.o 文件

## uboot 启动过程
- 一路跳转到 save_boot_params_ret: 首先获取处理器的工作模式
- 设置 CPSR 寄存器，进入 SVC 模式
- 设置 SCTLR 寄存器，使能向量表重定位
- 配置 CP15 协处理器寄存器，把 _start 地址写入寄存器，重定位中断向量表
- 调用函数 cpu_init_cp15、cpu_init_crit 和 _main
  - cpu_init_cp15 函数对 CP15 的寄存器做了一些配置
  - cpu_init_crit 函数调用了函数 lowlevel_init
    - 先设置 sp 指向 CONFIG_SYS_INIT_SP_ADDR
    - 接着执行 s_init 函数，对于 IMX6ULL 处理器，该函数是空函数。
  - 执行 _main 函数
    - 在_main 函数里面调用了 board_init_f、relocate_code、relocate_vectors 和 board_init_r 这 4 个函数
    - board_init_f 函数详解：主要有两个工作
      - 初始化一系列外设，比如串口、定时器，或者打印一些消息等
      - 初始化 gd 的各个成员变量，uboot 会将自己重定位到 DRAM 最后面的地址区域，也就是将自己拷贝到 DRAM 最后面的内存区域中
- run_main_loop 函数
  - 死循环中 main_loop 函数
  - 输出 uboot 信息。version_autogenerated.h
- cli_loop 函数
  - cli_loop 函数是 uboot 的命令行处理函数


bl 指令：位置无关指令，根据相对位置来寻址(pc + rel)，